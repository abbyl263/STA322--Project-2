---
output:
  pdf_document: default
  html_document: default
---

# STA322 Project 1
## Abby Li and Austin Huang

```{r, message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
```

```{r}
helicopter <- read.csv("project2-finaldata.csv")

# check that the data is consistent with averages calculated on sheets
mean_check <- aggregate(flight_time ~ trt, data = helicopter, FUN = mean)
```

### Description of Study Design

We chose to do a full 2^4 factorial experiment to examine how four factors- rotor length, leg length, leg width, and paper clip presence- affect flight time. Each factor has two levels (high and low) for a total of 16 helicopter designs (see photo for the 8 designs without paper clips). Specific helicopter factors are listed in table 1. Each helicopter was flown 4 times for a total of 64 randomized trials. We randomized the trials beforehand to reduce any bias from certain treatment combinations to ensure that the differences we observed in timing were due to the helicopters themselves and not other testing conditions. We chose to do a full factorial design to investigate the main effects and interaction effects without having to worry about aliasing, which is an issue that arises with a half factorial design. 

![](paper-helicopters.png){width=60%}

![](helicopter-factors.png){width=60%}

### Questions:
### Which factors seem to be most important for making helicopters that fly longer?

```{r}
boxplot(flight_time ~ trt, data=helicopter, xlab="Treatment", ylab="Flight Time")

model = lm(flight_time ~ rotor_length + leg_width + leg_length + paper_clip, data=helicopter)
boxplot(model$residual~helicopter$trt, xlab = "Treatment", ylab = "Residuals")
abline(0,0)
summary(model)
```

In the regular model with no interactions, the residuals deviate significantly from the 0 line, indicating that this model is a poor fit for the data. 

The presence of a paper clip is the only statistically significant factor (p=0.006), while rotor length, leg length, and leg width are not statistically significant. Thus, for the main effects model, the presence of a paper clip has the strongest effect on flight time and is the most important factor for making helicopters that fly longer.

```{r}
regfactexpwinteract = lm(flight_time ~ rotor_length * leg_width * leg_length * paper_clip, data = helicopter)
boxplot(regfactexpwinteract$residual~helicopter$trt, xlab = "Treatment", ylab = "Residuals")
abline(0,0)

summary(regfactexpwinteract)

# conf int for rotor_length and paper_clip
confint(regfactexpwinteract)["rotor_length", ]
confint(regfactexpwinteract)["paper_clip",]
```

```{r}
anova(model, regfactexpwinteract)
```

In the model with interactions, the residuals are much closer to 0, indicating that this model is a much better fit for the data. The only significant deviation from 0 is treatment ab, where there is a large negative outlier.

In our model summary, we see that all individual main effects seem to decrease flight time when increasing factors from their low to high level, with rotor_length having the most significant effect, followed by the presence of a paper clip. Specifically, the estimated effect of rotor length is -1.1 seconds, so on average, helicopters with longer rotors fly 1.1 seconds less than helicopters with shorter rotors, holding other variables constant (95% CI = [-1.47, -0.75]). The estimated effect of paper clip is -0.49 seconds, so on average, helicopters with paper clips fly -0.49 seconds less than helicopters without paper clips, holding other variables constant (95% CI = [-0.85, -0.13]). 
However, interestingly, we see that combinations of certain factors modify, and in some cases, lessen the flight time decrease effect from individual factors. For example, the positive two-way interaction terms including rotor_length:leg_width, rotor_length:leg_length, and rotor_length:paper_clip are less than 0.05, so there is evidence that the effect of rotor length depends on levels of leg width, leg length, and paper clip. 
Furthermore, the ANOVA test tells us that adding interaction effects does significantly improve the model. 

### Is there any evidence that the effect of rotor length differs by leg width?

```{r}
coef_est = coef(regfactexpwinteract)
ci = confint(regfactexpwinteract)

# rotor effect when leg width = LOW
tau_low  <- coef_est["rotor_length"]
ci_low   <- ci["rotor_length", ]

# rotor effect when leg width = HIGH
tau_high <- coef_est["rotor_length"] + coef_est["rotor_length:leg_width"]
ci_high <- ci["rotor_length", ] + ci["rotor_length:leg_width", ]

tau_table <- data.frame(
  Leg_Width = c("Low", "High"),
  Tau_Estimate = c(tau_low, tau_high),
  CI_Lower = c(ci_low[1], ci_high[1]),
  CI_Upper = c(ci_low[2], ci_high[2])
)

tau_table
```

There is significant evidence that the effect of rotor length differs by leg width. In the above model, we have an estimate of 0.88 and p = 0.00109 for the interaction term rotor_length:leg_width, indicating the effect of rotor length changes depending on leg width. When the leg width is small, increasing the rotor length from 7.5 to 8.5 cm reduces mean flight time by about 1.11 seconds (95% CI: -1.4672 to -0.7477). Since the 95% CI does not include 0, this effect is significant. When the leg width is large, increasing the rotor length reduces mean flight time by about 0.23 seconds (95% CI: -1.0961 to 0.6410683). Since the 95% CI does include 0, the effect is not significant.

Overall, there is strong evidence that the effect of rotor length differs by leg width. Since interaction effect is significant and the confidence intervals differ in magnitude, the effect of increasing rotor length depends on leg width.

### What would you recommend as the ideal combination to make the helicopter fly long?
Based on the full factorial model highlighted above, for the ideal combination to make a helicopter fly, we would recommend having a helicopter with a shorter rotor (7.5 cm), narrower legs (3.2 cm), shorter leg length (7.5 cm), and no paper clip. All these factors have negative main effects, indicating that higher levels (longer rotor, wider leg, longer leg, paper clip) decrease flight time. Although several interaction effects involving rotor length that are significant (see q1), these effects aren't sufficient enough in improving flight time compared to the baseline negative main effects. For example, the rotor_length x leg_length interaction effect is significant with a coefficient of 1.27. When legs are short, increasing rotor length reduces flight time by -1.1 seconds, and when legs are long, increasing rotor length increases flight time by 0.16 seconds (-1.1 + 1.27). However, even though this interaction is significant, the baseline design of short rotor and short legs will still have higher and better flight time overall. 

Thus, the most ideal combination to make the helicopter fly longer is for the four factors to be at their low levels (short rotor, narrow leg, short leg, no paper clip).



## Appendix

This is the code for releveling to get the 95% CI for the other 15 helicopter designs. 
```{r}
helicopter$rotor_length_low = 1 - helicopter$rotor_length
helicopter$leg_length_low = 1 - helicopter$leg_length
helicopter$leg_width_low = 1 - helicopter$leg_width
helicopter$paper_clip_low = 1 - helicopter$paper_clip

# the variables after regfactexpwinteract represent the helicopter with the mentioned treatments are the baseline
regfactexpwinteract_a = lm(flight_time ~ rotor_length_low * leg_length * leg_width * paper_clip, data = helicopter)
regfactexpwinteract_b = lm(flight_time ~ rotor_length * leg_length_low * leg_width * paper_clip, data = helicopter)
regfactexpwinteract_c = lm(flight_time ~ rotor_length * leg_length * leg_width_low * paper_clip, data = helicopter)
regfactexpwinteract_d = lm(flight_time ~ rotor_length * leg_length * leg_width * paper_clip_low, data = helicopter)
regfactexpwinteract_ab = lm(flight_time ~ rotor_length_low * leg_length_low * leg_width * paper_clip, data = helicopter)
regfactexpwinteract_ac = lm(flight_time ~ rotor_length_low * leg_length * leg_width_low * paper_clip, data = helicopter)
regfactexpwinteract_ad = lm(flight_time ~ rotor_length_low * leg_length * leg_width * paper_clip_low, data = helicopter)
regfactexpwinteract_bc = lm(flight_time ~ rotor_length * leg_length_low * leg_width_low * paper_clip, data = helicopter)
regfactexpwinteract_bd = lm(flight_time ~ rotor_length * leg_length_low * leg_width_low * paper_clip, data = helicopter)
regfactexpwinteract_cd = lm(flight_time ~ rotor_length * leg_length * leg_width_low * paper_clip_low, data = helicopter)
regfactexpwinteract_abc = lm(flight_time ~ rotor_length_low * leg_length_low * leg_width_low * paper_clip, data = helicopter)
regfactexpwinteract_abd = lm(flight_time ~ rotor_length_low * leg_length_low * leg_width * paper_clip_low, data = helicopter)
regfactexpwinteract_acd = lm(flight_time ~ rotor_length_low * leg_length * leg_width_low * paper_clip_low, data = helicopter)
regfactexpwinteract_bcd = lm(flight_time ~ rotor_length * leg_length_low * leg_width_low * paper_clip_low, data = helicopter)
regfactexpwinteract_abcd = lm(flight_time ~ rotor_length_low * leg_length_low * leg_width_low * paper_clip_low, data = helicopter)

cat("95% Confidence Interval for the baseline helicopter configuration (all treatments at low levels):\n")
confint(regfactexpwinteract)["(Intercept)",]
cat("95% Confidence Intervals for other helicopter treatments:\n")
confint(regfactexpwinteract_a)["(Intercept)",]
confint(regfactexpwinteract_b)["(Intercept)",]
confint(regfactexpwinteract_c)["(Intercept)",]
confint(regfactexpwinteract_d)["(Intercept)",]
confint(regfactexpwinteract_ab)["(Intercept)",]
confint(regfactexpwinteract_ac)["(Intercept)",]
confint(regfactexpwinteract_ad)["(Intercept)",]
confint(regfactexpwinteract_bc)["(Intercept)",]
confint(regfactexpwinteract_bd)["(Intercept)",]
confint(regfactexpwinteract_cd)["(Intercept)",]
confint(regfactexpwinteract_abc)["(Intercept)",]
confint(regfactexpwinteract_abd)["(Intercept)",]
confint(regfactexpwinteract_acd)["(Intercept)",]
confint(regfactexpwinteract_bcd)["(Intercept)",]
confint(regfactexpwinteract_abcd)["(Intercept)",]
```